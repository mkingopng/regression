---
title: "R Notebook"
output: html_document
---


```{r}
xx1=seq(from = -1,to = 1,length.out = 100)
yy=(1-abs(xx1)^3)^3
plot(xx1,yy,xlim = c(-2,2),type='l',xlab='u',ylab='K(u)')
lines(c(-2,-1),c(0,0)); lines(c(1,2),c(0,0))
yy=3/4*(1-xx1^2)
lines(xx1,yy,col=3)
xx2=seq(from = -2,to = 2,length.out = 200)
yy=dnorm(xx2)
lines(xx2,yy,col=4)
lines(c(-2,-1,-1,1,1,2),c(0,0,1/2,1/2,0,0),col=5)
lines(c(-2,-1,0,1,2),c(0,0,1,0,0),col=6)
legend("topleft", legend=c("tri-cube", "Epanechnikov", "Gaussian", "Box",
                           "Triangle"),lty=1, col=c(1,3,4,5,6))
```

```{r}
diabetes <- read.table("/course/data/diabetes.dat", header=TRUE, quote="\"")
diabetes <- diabetes[order(diabetes$Age),]
head(diabetes)
##     Age  Base.Deficit C.Peptide
## 15  0.9         -11.6       3.0
## 24  1.0          -8.2       3.9
## 6   1.8         -19.2       3.4
## 10  1.9         -25.0       3.7
## 11  2.2          -3.1       3.9
## 36  4.2         -17.0       5.1
```


```{r}
diabetes <- read.table("/course/data/diabetes.dat", header=TRUE, quote="\"")
diabetes <- diabetes[order(diabetes$Age),]
plot(diabetes$Age,log(diabetes$C.Peptide))
lines(ksmooth(diabetes$Age,log(diabetes$C.Peptide), bandwidth=5.0, kernel="normal"))
lines(ksmooth(diabetes$Age,log(diabetes$C.Peptide), bandwidth=2.0, kernel="normal"),
      lty=2)
title("Kernel smooth")
legend("topleft",c("bandwidth=5", "bandwidth=2"),lty=1:2)
```

```{r}
trade.union <- read.table("/course/data/tradeunion.dat", header = T)
attach(trade.union)
require(locfit)

# locfit 1.5-9.4 	 2020-03-24

fit=locfit(union.member~lp(wage,nn=0.7,deg=2), data=trade.union,family="binomial")
plot(fit,ylim = c(0,1),type='n',main="Trade Union Data")
newxx=seq(from = min(wage),to = max(wage),length.out = 100)
newdat=data.frame(wage=newxx)
ypred=predict(fit,newdat,se.fit = T)
lines(newxx,ypred$fit)
lines(newxx,ypred$fit-ypred$se.fit,lty=2)
lines(newxx,ypred$fit+ypred$se.fit,lty=2)
points(jitter(wage), union.member, main = "trade union data set", pch = 3)
```

trade.union <- read.table("/course/data/tradeunion.dat", header = T)
attach(trade.union)
require(locfit)

# locfit 1.5-9.4 	 2020-03-24

fit=locfit(union.member~lp(wage,nn=0.7,deg=2), data=trade.union,family="binomial")
plot(fit,ylim = c(0,1),type='n',main="Trade Union Data")
newxx=seq(from = min(wage),to = max(wage),length.out = 100)
newdat=data.frame(wage=newxx)
ypred=predict(fit,newdat,se.fit = T)
lines(newxx,ypred$fit)
lines(newxx,ypred$fit-ypred$se.fit,lty=2)
lines(newxx,ypred$fit+ypred$se.fit,lty=2)
points(jitter(wage), union.member, main = "trade union data set", pch = 3)

```{r}

```

Solution: Let us first load and inspect the data:
```{r}
ethanol<-read.table("../data/ethanol.txt",header=T)
print(dim(ethanol))
head(ethanol)
```

A scatterplot of NOxNOx against EE can be generated by:
```{r}
attach(ethanol)
plot(E, NOx)

Esq<-E*E
ethanol.lm<-lm(NOx~E+Esq)
Egrid<-seq(from=min(E),to=max(E),length=50)
new.data<-data.frame(E=Egrid,Esq=Egrid*Egrid)
ethanol.pred<-predict(ethanol.lm,newdata=new.data)
lines(Egrid,ethanol.pred,col=2)
lines(loess.smooth(E,NOx,span=0.2),lty=2,col=3)
```
From the above figure, it seems that loess smooth capture more bell-shaped structure of the data. This is slightly different from the quadratic regression fit.


```{r}
ethanol<-read.table("ethanol.txt",header=T)
print(dim(ethanol))

head(ethanol)

attach(ethanol)
plot(E, NOx)
Esq<-E*E
ethanol.lm<-lm(NOx~E+Esq)
Egrid<-seq(from=min(E),to=max(E),length=50)
new.data<-data.frame(E=Egrid,Esq=Egrid*Egrid)
ethanol.pred<-predict(ethanol.lm,newdata=new.data)
lines(Egrid,ethanol.pred,col=2)
lines(loess.smooth(E,NOx,span=0.2),lty=2,col=3)

```

# Activity in R: Kernel Smoother
Download the data set airair (there are four columns in this data frame, ozone, radiation, temperature and wind). The data set records New York Air Quality Measurements, May to September 1973.

Plot a scatterplot of ozoneozone against radiationradiation and superimpose loess and kernel smooths on the scatterplot. You may need to change the default level of smoothing for the kernel and loess smooths.

```{r}
air<-read.table("air.txt",header=T)
attach(air)
plot(radiation,ozone)
lines(loess.smooth(radiation,ozone),col=2)
lines(ksmooth(radiation,ozone,bandwidth=100),lty=2,col=3)
```

```{r}
air<-read.table("air.txt",header=T)
attach(air)
plot(radiation,ozone)
lines(loess.smooth(radiation,ozone),col=2)
lines(ksmooth(radiation,ozone,bandwidth=100),lty=2,col=3)
```


























































