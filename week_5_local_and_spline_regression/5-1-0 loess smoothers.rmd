---
title: "Loess Smoothers"
output: html_notebook
---

# Different kinds of weighting functions
Below, we visualise some weighting functions that can be used in the above algorithm. Note that they all integrate to 1. They mathematical definition is provided in the next slide.

```{r}
xx1 <- seq(from = -1, to = 1, length.out = 100)
yy <- (1-abs(xx1)^3)^3
plot(xx1,yy,xlim = c(-2,2),type='l',xlab='u',ylab='K(u)')
lines(c(-2,-1),c(0,0)); lines(c(1,2),c(0,0))
yy <- 3/4*(1-xx1^2)
lines(xx1,yy,col=3)
xx2 <- seq(from = -2, to = 2, length.out = 200)
yy <- dnorm(xx2)
lines(xx2,yy,col=4)
lines(c(-2,-1,-1,1,1,2),c(0,0,1/2,1/2,0,0),col=5)
lines(c(-2,-1,0,1,2),c(0,0,1,0,0),col=6)
legend("topleft", legend=c("tri-cube", "Epanechnikov", "Gaussian", "Box",
                           "Triangle"),lty=1, col=c(1,3,4,5,6))
```

# Example: Scatterplot smoothers
Recall the diabetes data set from the start of this section. This is data from a study of the factors affecting patterns of insulin-dependent diabetes mellitus in children, Sockett et al. 1987.

```{r}
diabetes <- read.table("data/diabetes.dat", header=TRUE, quote="\"")
diabetes <- diabetes[order(diabetes$Age),]
head(diabetes)

##     Age  Base.Deficit C.Peptide
## 15  0.9         -11.6       3.0
## 24  1.0          -8.2       3.9
## 6   1.8         -19.2       3.4
## 10  1.9         -25.0       3.7
## 11  2.2          -3.1       3.9
## 36  4.2         -17.0       5.1
```

The scatterplot smoothers for the diabetes data set were obtained as follows:

```{r}
diabetes <- read.table("data/diabetes.dat", header=TRUE, quote="\"")
diabetes <- diabetes[order(diabetes$Age),]
plot(diabetes$Age,diabetes$C.Peptide,main="Diabetes Data")
fit <- loess(diabetes$C.Peptide~diabetes$Age, diabetes)
pred <- predict(fit, diabetes$Age, se=T)

# lines(loess.smooth(diabetes$Age,diabetes$C.Peptide),col=2)
lines(diabetes$Age,predict(fit),col=2)
lines(diabetes$Age,pred$fit+2*pred$se.fit,lty=2)
lines(diabetes$Age,pred$fit-2*pred$se.fit,lty=2)
lines(diabetes$Age,runmed(x = diabetes$C.Peptide,k = 7),col=3)
legend("topleft", legend = c("loess", "running 7-median"),lty=c(1,1), col = 2:3)
##     Age  Base.Deficit C.Peptide
## 15  0.9         -11.6       3.0
## 24  1.0          -8.2       3.9
## 6   1.8         -19.2       3.4
## 10  1.9         -25.0       3.7
## 11  2.2          -3.1       3.9
## 36  4.2         -17.0       5.1
```


